import{j as I}from"./web.DVM8T0dH.js";import{c as S}from"./store.B14v2mcN.js";import{w as j}from"./emitter.DmOlwSOP.js";var H=typeof global=="object"&&global&&global.Object===Object&&global,M=typeof self=="object"&&self&&self.Object===Object&&self,$=H||M||Function("return this")(),w=$.Symbol,u=Object.prototype,p=u.hasOwnProperty,N=u.toString,f=w?w.toStringTag:void 0;function E(t){var n=p.call(t,f),i=t[f];try{t[f]=void 0;var e=!0}catch{}var o=N.call(t);return e&&(n?t[f]=i:delete t[f]),o}var P=Object.prototype,G=P.toString;function z(t){return G.call(t)}var B="[object Null]",A="[object Undefined]",T=w?w.toStringTag:void 0;function L(t){return t==null?t===void 0?A:B:T&&T in Object(t)?E(t):z(t)}function R(t){return t!=null&&typeof t=="object"}var _="[object Symbol]";function k(t){return typeof t=="symbol"||R(t)&&L(t)==_}var v=/\s/;function C(t){for(var n=t.length;n--&&v.test(t.charAt(n)););return n}var D=/^\s+/;function F(t){return t&&t.slice(0,C(t)+1).replace(D,"")}function W(t){var n=typeof t;return t!=null&&(n=="object"||n=="function")}var x=NaN,U=/^[-+]0x[0-9a-f]+$/i,q=/^0b[01]+$/i,J=/^0o[0-7]+$/i,K=parseInt;function b(t){if(typeof t=="number")return t;if(k(t))return x;if(W(t)){var n=typeof t.valueOf=="function"?t.valueOf():t;t=W(n)?n+"":n}if(typeof t!="string")return t===0?t:+t;t=F(t);var i=q.test(t);return i||J.test(t)?K(t.slice(2),i?2:8):U.test(t)?x:+t}function Q(t,n,i){return t===t&&(i!==void 0&&(t=t<=i?t:i),n!==void 0&&(t=t>=n?t:n)),t}function l(t,n,i){return i===void 0&&(i=n,n=void 0),i!==void 0&&(i=b(i),i=i===i?i:0),n!==void 0&&(n=b(n),n=n===n?n:0),Q(b(t),n,i)}const[s,O]=S([]),[g,y]=S([]);let V=0;j.on("appendWindow",t=>{const n=window.innerWidth,i=window.innerHeight;let e=t.width??(n>1e3?438:n>=768?375:n),o=t.height??Math.min(i,768);e=Math.min(e,n),o=Math.min(o,i);let r=n-e,d=0;function m(){for(const c of g)if(c.geometry.x===r&&c.geometry.y===d&&c.geometry.width===e)return d+=32,!0;return!1}for(;m(););const a=++V,h={...t,id:a,status:"normal",geometry:{x:r,y:d,width:e,height:o,aspectRatio:e/o},zIndex:g.length+1};y([...g,h]),O([...s,a])});function X(t){const{x:n,y:i,width:e,height:o}=t.geometry;return n+e>window.innerWidth||i+o>window.innerHeight||n<0||i<0}window.addEventListener("resize",()=>{const t=Math.min(window.innerWidth,300),n=Math.min(window.innerHeight,400);I(()=>{for(const i of g){if(!X(i))continue;let{x:e,y:o,width:r,height:d}=i.geometry;const m=l(r,t,window.innerWidth),a=l(d,n,window.innerHeight),h=Math.min(m/r,a/d);r=Math.floor(h*r),d=Math.floor(h*d),e+r/2>window.innerWidth&&(e=Math.max(0,window.innerWidth-r/2)),o>window.innerHeight-48&&(o=l(o,0,window.innerHeight-48)),y(c=>c.id===i.id,"geometry",c=>({...c,x:e,y:o,width:r,height:d}))}})});j.on("closeWindow",t=>{y(n=>n.filter(({id:i})=>i!==t.id)),O(n=>n.filter(i=>i!==t.id))});j.on("focusWindow",({id:t})=>{const n=s.findIndex(e=>e===t);if(n===-1||n===s.length-1)return;const i=[...s.slice(0,n),...s.slice(n+1),t];O(i),i.forEach((e,o)=>{y(r=>r.id===e,"zIndex",()=>o+1)})});export{l as c,y as s,g as w};
