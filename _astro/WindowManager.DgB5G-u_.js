import{l as A,d as se,g as S,t as k,a as D,b as H,r as Y,n as He,o as De,e as y,p as M,i as f,c as v,q as re,u as F,v as Pe,w as ge,s as ae,F as Le}from"./web.DVM8T0dH.js";import{w as le}from"./emitter.DmOlwSOP.js";import{c as w,w as qe,s as C}from"./windows.DVnrkHgL.js";import"./store.B14v2mcN.js";function de(){he()!==document.activeElement&&Ie(document.activeElement),requestAnimationFrame(de)}requestAnimationFrame(de);const[he,Ie]=A(null);var Ne=k("<div>");function z(t){const[m,h]=A(!1),u=t.minWidth??300,a=t.minHeight??400;let _=0,g=0,o=0,r=0,i={...t.geometry},c={...t.geometry},x=null;function $(){const n=o-_,d=r-g;let e={...i};switch(t.edge){case"top":e.height=w(i.height-d,a,window.innerHeight-i.y-d),e.y=i.y+(i.height-e.height);break;case"bottom":e.height=w(i.height+d,a,window.innerHeight-i.y);break;case"left":e.width=w(i.width-n,u,window.innerWidth-i.x-n),e.x=i.x+(i.width-e.width);break;case"right":e.width=w(i.width+n,u,window.innerWidth-i.x);break;case"top-left":e.width=w(i.width-n,u,window.innerWidth-i.x-n),e.x=i.x+(i.width-e.width),e.height=w(i.height-d,a,window.innerHeight-i.y-d),e.y=i.y+(i.height-e.height);break;case"top-right":e.width=w(i.width+n,u,window.innerWidth-i.x),e.height=w(i.height-d,a,window.innerHeight-i.y-d),e.y=i.y+(i.height-e.height);break;case"bottom-left":e.width=w(i.width-n,u,window.innerWidth-i.x-n),e.x=i.x+(i.width-e.width),e.height=w(i.height+d,a,window.innerHeight-i.y);break;case"bottom-right":e.width=w(i.width+n,u,window.innerWidth-i.x),e.height=w(i.height+d,a,window.innerHeight-i.y);break}const s=e.width/e.height;(e.x!==c.x||e.y!==c.y||e.width!==c.width||e.height!==c.height)&&(c={...e,aspectRatio:s},t.onResize({...e,aspectRatio:s})),m()&&(x=requestAnimationFrame($))}function b(n){m()&&(n.preventDefault(),n.stopImmediatePropagation(),o=n.pageX,r=n.pageY)}function E(n){h(!0),t.onResizingChange?.(!0),_=n.pageX,g=n.pageY,o=n.pageX,r=n.pageY,i={...t.geometry},c={...t.geometry},n.stopImmediatePropagation(),x=requestAnimationFrame($),window.addEventListener("pointermove",b),window.addEventListener("pointerup",R)}function R(){h(!1),t.onResizingChange?.(!1),x!==null&&(cancelAnimationFrame(x),x=null),window.removeEventListener("pointermove",b),window.removeEventListener("pointerup",R)}const W=()=>{switch(t.edge){case"top":return"absolute w-full h-1 -top-1 hover:cursor-ns-resize";case"bottom":return"absolute w-full h-1 -bottom-1 hover:cursor-ns-resize";case"left":return"absolute h-full w-1 -left-1 hover:cursor-ew-resize";case"right":return"absolute h-full w-1 -right-1 hover:cursor-ew-resize";case"top-left":return"absolute w-2 h-2 -top-1 -left-1 hover:cursor-nwse-resize";case"top-right":return"absolute w-2 h-2 -top-1 -right-1 hover:cursor-nesw-resize";case"bottom-left":return"absolute w-2 h-2 -bottom-1 -left-1 hover:cursor-nesw-resize";case"bottom-right":return"absolute w-2 h-2 -bottom-1 -right-1 hover:cursor-nwse-resize"}};return(()=>{var n=S(Ne);return n.$$pointerdown=E,D(()=>H(n,W())),Y(),n})()}se(["pointerdown"]);var je=k('<i class="icon-[mdi--maximize] cursor-pointer"aria-label="Maximize window"tabindex=0>'),Ge=k('<div class="absolute inset-0 select-none">'),Ke=k('<div role=dialog aria-modal=false tabindex=-1><div class="h-full w-full flex flex-col glassmorphism rounded-sm m-0.5 relative"><section class="flex justify-around items-center p-1 select-none pointer-events-auto text-[1.25rem]"><span class=w-16></span><h2 class="flex-1 text-center truncate m-0 font-normal text-base"></h2><span class="flex gap-2"role=group aria-label="Window controls"><i class="icon-[mdi--minimize] cursor-pointer"aria-label="Minimize window"tabindex=0></i><!$><!/><i class="icon-[mdi--close] cursor-pointer"aria-label="Close window"tabindex=0></i></span></section><div class="flex-1 rounded-inherit relative overflow-hidden"><!$><!/><div></div></div><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/>'),Oe=k('<i class="icon-[mdi--dock-window] cursor-pointer"aria-label="Restore window"tabindex=0>');function Te(t){let[m,h]=A(!1),[u,a]=A(!1);const _=He(()=>t.children);function g(e){e.key==="Escape"&&t.onClose()}let o=0,r=0,i=0,c=0,x=0,$=0,b=null;function E(){const e=w(i+o,-t.geometry.width/2,window.innerWidth-t.geometry.width/2),s=w(c+r,0,window.innerHeight-48);(e!==x||s!==$)&&(x=e,$=s,t.onMove(e,s)),m()&&(b=requestAnimationFrame(E))}function R(e){if(m()){if(e.pageX<0||e.pageY<0||e.pageX>window.innerWidth||e.pageY>window.innerHeight){n();return}e.preventDefault(),e.stopImmediatePropagation(),i=e.pageX,c=e.pageY}}function W(e){h(!0),o=t.geometry.x-e.pageX,r=t.geometry.y-e.pageY,i=e.pageX,c=e.pageY,x=t.geometry.x,$=t.geometry.y,e.stopImmediatePropagation(),b=requestAnimationFrame(E),window.addEventListener("pointermove",R),window.addEventListener("pointerup",n)}function n(){h(!1),b!==null&&(cancelAnimationFrame(b),b=null),window.removeEventListener("pointermove",R),window.removeEventListener("pointerup",n)}let d;return De(()=>{d?.contains(he())&&t.onFocus()}),(()=>{var e=S(Ke),s=e.firstChild,X=s.firstChild,ce=X.firstChild,L=ce.nextSibling,q=L.nextSibling,I=q.firstChild,me=I.nextSibling,[N,ue]=y(me.nextSibling),we=N.nextSibling,P=X.nextSibling,fe=P.firstChild,[j,ve]=y(fe.nextSibling),G=j.nextSibling,xe=P.nextSibling,[K,be]=y(xe.nextSibling),ye=K.nextSibling,[O,$e]=y(ye.nextSibling),ze=O.nextSibling,[T,_e]=y(ze.nextSibling),Re=T.nextSibling,[B,Se]=y(Re.nextSibling),ke=B.nextSibling,[J,Ee]=y(ke.nextSibling),Ce=J.nextSibling,[Q,We]=y(Ce.nextSibling),Me=Q.nextSibling,[U,Fe]=y(Me.nextSibling),Xe=U.nextSibling,[Ye,Ae]=y(Xe.nextSibling);e.$$keydown=g,M(e,"focus",t.onFocus);var V=d;return typeof V=="function"?Pe(V,e):d=e,X.$$dblclick=()=>t.status==="maximum"?t.onDock():t.onMaximize(),X.$$pointerdown=W,f(L,()=>t.title),M(I,"click",t.onMinimize,!0),f(q,v(re,{get when(){return t.status==="normal"},get fallback(){return(()=>{var l=S(Oe);return M(l,"click",t.onDock,!0),Y(),l})()},get children(){var l=S(je);return M(l,"click",t.onMaximize,!0),Y(),l}}),N,ue),M(we,"click",t.onClose,!0),f(P,v(re,{get when(){return m()||u()},get children(){return S(Ge)}}),j,ve),f(G,_),f(s,v(z,{edge:"top",get geometry(){return t.geometry},get onResize(){return t.onResize},onResizingChange:a}),K,be),f(s,v(z,{edge:"bottom",get geometry(){return t.geometry},get onResize(){return t.onResize},onResizingChange:a}),O,$e),f(s,v(z,{edge:"left",get geometry(){return t.geometry},get onResize(){return t.onResize},onResizingChange:a}),T,_e),f(s,v(z,{edge:"right",get geometry(){return t.geometry},get onResize(){return t.onResize},onResizingChange:a}),B,Se),f(s,v(z,{edge:"top-left",get geometry(){return t.geometry},get onResize(){return t.onResize},onResizingChange:a}),J,Ee),f(s,v(z,{edge:"top-right",get geometry(){return t.geometry},get onResize(){return t.onResize},onResizingChange:a}),Q,We),f(s,v(z,{edge:"bottom-left",get geometry(){return t.geometry},get onResize(){return t.onResize},onResizingChange:a}),U,Fe),f(s,v(z,{edge:"bottom-right",get geometry(){return t.geometry},get onResize(){return t.onResize},onResizingChange:a}),Ye,Ae),D(l=>{var Z=`fixed p-1 ${t.status==="minimum"?"pointer-events-none invisible":""}`,p=t.geometry.width+"px",ee=t.geometry.height+"px",te=t.geometry.x+"px",ie=t.geometry.y+"px",ne=t.zIndex,oe=`h-full w-full rounded-inherit ${m()||u()?"select-none":""}`;return Z!==l.e&&H(e,l.e=Z),p!==l.t&&F(e,"width",l.t=p),ee!==l.a&&F(e,"height",l.a=ee),te!==l.o&&F(e,"left",l.o=te),ie!==l.i&&F(e,"top",l.i=ie),ne!==l.n&&F(e,"z-index",l.n=ne),oe!==l.s&&H(G,l.s=oe),l},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0}),Y(),e})()}se(["keydown","pointerdown","dblclick","click"]);var Be=k('<iframe class="h-full w-full rounded-inherit">');function Je(t){return v(Te,ge(t,{get children(){var m=S(Be);return D(h=>{var u=t.url.toString(),a=t.title;return u!==h.e&&ae(m,"src",h.e=u),a!==h.t&&ae(m,"title",h.t=a),h},{e:void 0,t:void 0}),m}}))}var Qe=k("<div>");function et(t){const m=new Map,h=new Map;function u(g){return 1-Math.pow(1-g,3)}function a(g,o,r){return g+(o-g)*r}function _(g,o,r,i=300,c){const x=h.get(g);x&&cancelAnimationFrame(x);const $=performance.now();function b(R){const W=R-$,n=Math.min(W/i,1),d=u(n),e={x:a(o.x,r.x,d),y:a(o.y,r.y,d),width:a(o.width,r.width,d),height:a(o.height,r.height,d),aspectRatio:r.aspectRatio};if(C(s=>s.id===g,"geometry",()=>e),n<1){const s=requestAnimationFrame(b);h.set(g,s)}else h.delete(g),c?.()}const E=requestAnimationFrame(b);h.set(g,E)}return(()=>{var g=S(Qe);return f(g,v(Le,{each:qe,children:o=>v(Je,ge(o,{onFocus:()=>le.emit("focusWindow",{id:o.id}),onClose:()=>{le.emit("closeWindow",{id:o.id})},onMove:(r,i)=>{C(c=>c.id===o.id,"geometry",c=>({...c,x:r,y:i}))},onResize:r=>{C(i=>i.id===o.id,"geometry",()=>({...r}))},onMaximize:()=>{m.set(o.id,{...o.geometry});const r={width:window.innerWidth,height:window.innerHeight,x:0,y:0,aspectRatio:window.innerWidth/window.innerHeight};_(o.id,o.geometry,r,300,()=>{C(i=>i.id===o.id,"status",()=>"maximum")})},onMinimize:()=>{C(r=>r.id===o.id,"status",()=>"minimum")},onDock:()=>{const r=m.get(o.id);m.delete(o.id),_(o.id,o.geometry,r,300,()=>{C(i=>i.id===o.id,"status",()=>"normal")})}}))})),D(()=>H(g,t.class)),g})()}export{et as WindowManager};
