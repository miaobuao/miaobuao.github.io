<!DOCTYPE html><script type="module" src="/_astro/BlogPostEmbedLayout.astro_astro_type_script_index_0_lang.CBnQuka3.js"></script> <html lang="zh-CN" class="no-scrollbar"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>股票买卖II-动态规划</title><!-- Open Graph / Facebook --><meta property="og:title" content="股票买卖II-动态规划"><meta property="og:type" content="website"><meta property="og:url" content="https://yangqiuyi.com/embed/blog/%E7%AE%97%E6%B3%95/%E8%82%A1%E7%A5%A8%E4%B9%B0%E5%8D%96ii-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/"><meta name="description" content="又是一道DP题！

"><meta property="og:description" content="又是一道DP题！

"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/_astro/ClientRouter.astro_astro_type_script_index_0_lang.DY52MY3N.js"></script><link rel="stylesheet" href="/_astro/_slug_.DyZWVpeX.css"><script type="module" src="/_astro/page.nXIIYMne.js"></script></head> <body class="dark:text-white max-w-prose mx-auto">  <div class="flex flex-col rounded-lg"> <header class="p-4 flex flex-col"> <p class="break-all text-lg md:text-xl font-bold"> 股票买卖II-动态规划 </p> <p class="text-sm"> 杨秋逸 · 2021-04-15 </p> </header> <article class="prose max-sm:prose-sm dark:prose-invert text-inherit max-w-full py-4 px-4">  <p>又是一道DP题！</p>
<!--more-->
<h2 id="题目"><a href="#题目">题目</a></h2>
<p>给定一个长度为 N 的数组，数组中的第 i 个数字表示一个给定股票在第 i 天的价格。</p>
<p>设计一个算法来计算你所能获取的最大利润。你可以尽可能地完成更多的交易（多次买卖一支股票）。</p>
<p>注意：你不能同时参与多笔交易（你必须在再次购买前出售掉之前的股票）。</p>
<p><strong>输入格式</strong>
第一行包含整数 N，表示数组长度。</p>
<p>第二行包含 N 个不大于 10000 的正整数，表示完整的数组。</p>
<p><strong>输出格式</strong>
输出一个整数，表示最大利润。
<strong>数据范围</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>1≤N≤105</span></span></code></pre>
<p><strong>输入样例1：</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>6</span></span>
<span class="line"><span>7 1 5 3 6 4</span></span></code></pre>
<p><strong>输出样例1：</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>7</span></span></code></pre>
<p><strong>输入样例2：</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>5</span></span>
<span class="line"><span>1 2 3 4 5</span></span></code></pre>
<p><strong>输出样例2：</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>4</span></span></code></pre>
<p><strong>输入样例3：</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>5</span></span>
<span class="line"><span>7 6 4 3 1</span></span></code></pre>
<p><strong>输出样例3：</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>0</span></span></code></pre>
<p><strong>样例解释</strong>
样例1：在第 2 天（股票价格 = 1）的时候买入，在第 3 天（股票价格 = 5）的时候卖出, 这笔交易所能获得利润 = 5-1 = 4 。随后，在第 4 天（股票价格 = 3）的时候买入，在第 5 天（股票价格 = 6）的时候卖出, 这笔交易所能获得利润 = 6-3 = 3 。共得利润 4+3 = 7。</p>
<p>样例2：在第 1 天（股票价格 = 1）的时候买入，在第 5 天 （股票价格 = 5）的时候卖出, 这笔交易所能获得利润 = 5-1 = 4 。注意你不能在第 1 天和第 2 天接连购买股票，之后再将它们卖出。因为这样属于同时参与了多笔交易，你必须在再次购买前出售掉之前的股票。</p>
<p>样例3：在这种情况下, 不进行任何交易, 所以最大利润为 0。</p>
<h2 id="解析1"><a href="#解析1">解析1</a></h2>
<p><img alt="分析1" loading="lazy" decoding="async" fetchpriority="auto" width="2162" height="1113" src="/_astro/1.CntB0tmC_ZEKOXX.webp" ></p>
<p><img alt="分析2" loading="lazy" decoding="async" fetchpriority="auto" width="1500" height="500" src="/_astro/2.sfkjgC4l_Z2lMpz5.webp" ></p>
<p>一共只22有种状态:</p>
<p><strong>1. 当前处于未持股状态0：</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>对应可以进行的转换：</span></span>
<span class="line"><span>0->0 （不买入，继续观望，那么就什么都不发生）</span></span>
<span class="line"><span>0->1 （买入股票，那么收益就要减去当前市场的股票价格）</span></span></code></pre>
<p><strong>2. 当前处于持股状态1：</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>对应可以进行的转换：</span></span>
<span class="line"><span>1->1 （不卖出，继续观望，那么就什么都不发生）</span></span>
<span class="line"><span>1->0 （卖出股票，那么收益就要加上当前市场的股票价格）</span></span></code></pre>
<h3 id="代码"><a href="#代码">代码</a></h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#F97583">#include</span><span style="color:#9ECBFF"> &#x3C;iostream></span></span>
<span class="line"><span style="color:#F97583">using</span><span style="color:#F97583"> namespace</span><span style="color:#B392F0"> std</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">int</span><span style="color:#E1E4E8"> f</span><span style="color:#79b8ff">[</span><span style="color:#79B8FF">100005</span><span style="color:#79b8ff">]</span><span style="color:#79b8ff">[</span><span style="color:#79B8FF">2</span><span style="color:#79b8ff">]</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">int</span><span style="color:#E1E4E8"> a</span><span style="color:#79b8ff">[</span><span style="color:#79B8FF">100005</span><span style="color:#79b8ff">]</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">int</span><span style="color:#B392F0"> main</span><span style="color:#79b8ff">(</span><span style="color:#79b8ff">)</span></span>
<span class="line"><span style="color:#79b8ff">{</span></span>
<span class="line"><span style="color:#F97583">    int</span><span style="color:#E1E4E8"> n;</span></span>
<span class="line"><span style="color:#E1E4E8">    cin</span><span style="color:#F97583">></span><span style="color:#F97583">></span><span style="color:#E1E4E8">n;</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#ffab70">(</span><span style="color:#F97583">int</span><span style="color:#E1E4E8"> i</span><span style="color:#F97583">=</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">;i</span><span style="color:#F97583">&#x3C;</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">n;i</span><span style="color:#F97583">++</span><span style="color:#ffab70">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span><span style="color:#ffab70">{</span></span>
<span class="line"><span style="color:#E1E4E8">        cin</span><span style="color:#F97583">></span><span style="color:#F97583">></span><span style="color:#E1E4E8">a</span><span style="color:#b392f0">[</span><span style="color:#E1E4E8">i</span><span style="color:#b392f0">]</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    </span><span style="color:#ffab70">}</span></span>
<span class="line"><span style="color:#E1E4E8">    f</span><span style="color:#ffab70">[</span><span style="color:#79B8FF">0</span><span style="color:#ffab70">]</span><span style="color:#ffab70">[</span><span style="color:#79B8FF">1</span><span style="color:#ffab70">]</span><span style="color:#F97583">=-</span><span style="color:#F97583"> 0x</span><span style="color:#79B8FF">3f3f3f3f</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#ffab70">(</span><span style="color:#F97583">int</span><span style="color:#E1E4E8"> i</span><span style="color:#F97583">=</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">;i</span><span style="color:#F97583">&#x3C;</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">n;i</span><span style="color:#F97583">++</span><span style="color:#ffab70">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span><span style="color:#ffab70">{</span></span>
<span class="line"><span style="color:#E1E4E8">        f</span><span style="color:#b392f0">[</span><span style="color:#E1E4E8">i</span><span style="color:#b392f0">]</span><span style="color:#b392f0">[</span><span style="color:#79B8FF">0</span><span style="color:#b392f0">]</span><span style="color:#F97583">=</span><span style="color:#B392F0">max</span><span style="color:#b392f0">(</span><span style="color:#E1E4E8">f</span><span style="color:#79b8ff">[</span><span style="color:#E1E4E8">i</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#79b8ff">]</span><span style="color:#79b8ff">[</span><span style="color:#79B8FF">0</span><span style="color:#79b8ff">]</span><span style="color:#E1E4E8">,f</span><span style="color:#79b8ff">[</span><span style="color:#E1E4E8">i</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#79b8ff">]</span><span style="color:#79b8ff">[</span><span style="color:#79B8FF">1</span><span style="color:#79b8ff">]</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">a</span><span style="color:#79b8ff">[</span><span style="color:#E1E4E8">i</span><span style="color:#79b8ff">]</span><span style="color:#b392f0">)</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        f</span><span style="color:#b392f0">[</span><span style="color:#E1E4E8">i</span><span style="color:#b392f0">]</span><span style="color:#b392f0">[</span><span style="color:#79B8FF">1</span><span style="color:#b392f0">]</span><span style="color:#F97583">=</span><span style="color:#B392F0">max</span><span style="color:#b392f0">(</span><span style="color:#E1E4E8">f</span><span style="color:#79b8ff">[</span><span style="color:#E1E4E8">i</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#79b8ff">]</span><span style="color:#79b8ff">[</span><span style="color:#79B8FF">1</span><span style="color:#79b8ff">]</span><span style="color:#E1E4E8">,f</span><span style="color:#79b8ff">[</span><span style="color:#E1E4E8">i</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#79b8ff">]</span><span style="color:#79b8ff">[</span><span style="color:#79B8FF">0</span><span style="color:#79b8ff">]</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">a</span><span style="color:#79b8ff">[</span><span style="color:#E1E4E8">i</span><span style="color:#79b8ff">]</span><span style="color:#b392f0">)</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    </span><span style="color:#ffab70">}</span></span>
<span class="line"><span style="color:#E1E4E8">    cout</span><span style="color:#F97583">&#x3C;</span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8">f</span><span style="color:#ffab70">[</span><span style="color:#E1E4E8">n</span><span style="color:#ffab70">]</span><span style="color:#ffab70">[</span><span style="color:#79B8FF">0</span><span style="color:#ffab70">]</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#79b8ff">}</span></span></code></pre>
<h2 id="解法二"><a href="#解法二">解法二</a></h2>
<p><strong>用贪心算法做！</strong>
纵然，我们可以用DP搜索出所有的方案数，但是通过观察，我们可以发现本题最优解方案存在一定的性质。</p>
<p>测试样例的折线图形式（绿色标出下降，红色标出上升）：</p>
<p><img alt="折线图" loading="lazy" decoding="async" fetchpriority="auto" width="1499" height="1103" src="/_astro/3.BjltazAg_Z4hDdz.webp" ></p>
<p>考虑一种方案，在每次上升的前一天购入股票，并在上升后的当天卖出的方案</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>if (w[i] > w[i - 1])</span></span>
<span class="line"><span>    res += w[i] - w[i - 1];</span></span></code></pre>
<p>接下来证明该贪心思路得出的方案即是最优解。</p>
<p><strong>（1）证明贪心解 ≤≤ 最优解：</strong>
由于贪心解都是取区间长度为 11 的解，因此假设存在于最优解中的某个区间 [i,j][i,j] 的长度 >1>1
那么会出现一下三种情况：
<img alt="三种情形" loading="lazy" decoding="async" fetchpriority="auto" width="1736" height="1223" src="/_astro/4.NDYL5qLt_9bVbv.webp" >
对应三种情形：最优解选取的区间最终点位于上方、下方、相等。</p>
<p>对于情形一：显然 最优解 &#x3C;&#x3C; 贪心解
对于情形二：显然 最优解 &#x3C;&#x3C; 贪心解
对于情形三：毫无疑问，这就是存在于贪心解中的情形，因此 贪心解 == 最优解</p>
<p>得证</p>
<p>（2）证明贪心解 ≥≥ 最优解：
这部分无需证明，因为贪心解即是合法解，所以他的方案必定大于等于最优解</p>
<h3 id="代码-1"><a href="#代码-1">代码</a></h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#F97583">#include</span><span style="color:#9ECBFF"> &#x3C;iostream></span></span>
<span class="line"><span style="color:#F97583">using</span><span style="color:#F97583"> namespace</span><span style="color:#B392F0"> std</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8"> N </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 1</span><span style="color:#F97583">e</span><span style="color:#79B8FF">5</span><span style="color:#F97583"> +</span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">, INF </span><span style="color:#F97583">=</span><span style="color:#F97583"> 0x</span><span style="color:#79B8FF">3f3f3f3f</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">int</span><span style="color:#E1E4E8"> n;</span></span>
<span class="line"><span style="color:#F97583">int</span><span style="color:#E1E4E8"> w</span><span style="color:#79b8ff">[</span><span style="color:#E1E4E8">N</span><span style="color:#79b8ff">]</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">int</span><span style="color:#B392F0"> main</span><span style="color:#79b8ff">(</span><span style="color:#79b8ff">)</span><span style="color:#E1E4E8"> </span><span style="color:#79b8ff">{</span></span>
<span class="line"><span style="color:#B392F0">    scanf</span><span style="color:#ffab70">(</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">%d</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">&#x26;</span><span style="color:#E1E4E8">n</span><span style="color:#ffab70">)</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> </span><span style="color:#ffab70">(</span><span style="color:#F97583">int</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&#x3C;</span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> n; </span><span style="color:#F97583">++</span><span style="color:#E1E4E8">i</span><span style="color:#ffab70">)</span><span style="color:#E1E4E8"> </span><span style="color:#B392F0">scanf</span><span style="color:#ffab70">(</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">%d</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">&#x26;</span><span style="color:#E1E4E8">w</span><span style="color:#b392f0">[</span><span style="color:#E1E4E8">i</span><span style="color:#b392f0">]</span><span style="color:#ffab70">)</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    int</span><span style="color:#E1E4E8"> res </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> </span><span style="color:#ffab70">(</span><span style="color:#F97583">int</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&#x3C;</span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> n </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">; </span><span style="color:#F97583">++</span><span style="color:#E1E4E8">i</span><span style="color:#ffab70">)</span><span style="color:#E1E4E8"> </span><span style="color:#ffab70">{</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> </span><span style="color:#b392f0">(</span><span style="color:#E1E4E8">w</span><span style="color:#79b8ff">[</span><span style="color:#E1E4E8">i</span><span style="color:#79b8ff">]</span><span style="color:#E1E4E8"> </span><span style="color:#F97583">-</span><span style="color:#E1E4E8"> w</span><span style="color:#79b8ff">[</span><span style="color:#E1E4E8">i </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 1</span><span style="color:#79b8ff">]</span><span style="color:#E1E4E8"> </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 0</span><span style="color:#b392f0">)</span><span style="color:#E1E4E8"> res </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> w</span><span style="color:#b392f0">[</span><span style="color:#E1E4E8">i</span><span style="color:#b392f0">]</span><span style="color:#E1E4E8"> </span><span style="color:#F97583">-</span><span style="color:#E1E4E8"> w</span><span style="color:#b392f0">[</span><span style="color:#E1E4E8">i </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 1</span><span style="color:#b392f0">]</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    </span><span style="color:#ffab70">}</span></span>
<span class="line"><span style="color:#B392F0">    printf</span><span style="color:#ffab70">(</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">%d\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">, res</span><span style="color:#ffab70">)</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#79b8ff">}</span></span></code></pre>  </article> </div> <div class="mt-8 p-2"> <script type="module" src="/_astro/Giscus.astro_astro_type_script_index_0_lang.C2pfN53L.js"></script> <giscus-widget repo="miaobuao/miaobuao.github.io" repoId="R_kgDOJONNeg" categoryId="DIC_kwDOJONNes4CVJhu" mapping="og:title" strict="0" reactionsEnabled="1" emitMetadata="0" inputPosition="top" theme="preferred_color_scheme" lang="zh-CN" loading="lazy"></giscus-widget> </div><div class="h-16 sm:h-0"></div>  </body></html>