<!DOCTYPE html><script type="module" src="/_astro/BlogPostLayout.astro_astro_type_script_index_0_lang.CQKIrR8a.js"></script> <html lang="zh-CN" class="no-scrollbar"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Nuxt/Nitro é›†æˆ Cloudflare D1 Database</title><!-- Open Graph / Facebook --><meta property="og:title" content="Nuxt/Nitro é›†æˆ Cloudflare D1 Database"><meta property="og:type" content="website"><meta property="og:url" content="https://yangqiuyi.com/blog/kai-fa/nuxt_nitro-ji-cheng-cloudflare-d1-database/"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/_astro/ClientRouter.astro_astro_type_script_index_0_lang.DY52MY3N.js"></script><link rel="stylesheet" href="/_astro/_slug_.DyZWVpeX.css">
<style>progressive-image[data-astro-cid-njl3qch2]{display:block}
@keyframes astroFadeInOut{0%{opacity:1}to{opacity:0}}@keyframes astroFadeIn{0%{opacity:0;mix-blend-mode:plus-lighter}to{opacity:1;mix-blend-mode:plus-lighter}}@keyframes astroFadeOut{0%{opacity:1;mix-blend-mode:plus-lighter}to{opacity:0;mix-blend-mode:plus-lighter}}@keyframes astroSlideFromRight{0%{transform:translate(100%)}}@keyframes astroSlideFromLeft{0%{transform:translate(-100%)}}@keyframes astroSlideToRight{to{transform:translate(100%)}}@keyframes astroSlideToLeft{to{transform:translate(-100%)}}@media(prefers-reduced-motion){::view-transition-group(*),::view-transition-old(*),::view-transition-new(*){animation:none!important}[data-astro-transition-scope]{animation:none!important}}
</style><script type="module" src="/_astro/page.nXIIYMne.js"></script><style>[data-astro-transition-scope="astro-uniujczg-1"] { view-transition-name: avatar; }@layer astro { ::view-transition-old(avatar) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }::view-transition-new(avatar) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; }[data-astro-transition=back]::view-transition-old(avatar) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }[data-astro-transition=back]::view-transition-new(avatar) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; } }[data-astro-transition-fallback="old"] [data-astro-transition-scope="astro-uniujczg-1"],
			[data-astro-transition-fallback="old"][data-astro-transition-scope="astro-uniujczg-1"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }[data-astro-transition-fallback="new"] [data-astro-transition-scope="astro-uniujczg-1"],
			[data-astro-transition-fallback="new"][data-astro-transition-scope="astro-uniujczg-1"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; }[data-astro-transition=back][data-astro-transition-fallback="old"] [data-astro-transition-scope="astro-uniujczg-1"],
			[data-astro-transition=back][data-astro-transition-fallback="old"][data-astro-transition-scope="astro-uniujczg-1"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }[data-astro-transition=back][data-astro-transition-fallback="new"] [data-astro-transition-scope="astro-uniujczg-1"],
			[data-astro-transition=back][data-astro-transition-fallback="new"][data-astro-transition-scope="astro-uniujczg-1"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; }</style></head> <body class="dark:text-white"> <div class="relative h-screen pointer-events-none"> <div class="absolute w-screen h-screen pointer-events-none" data-astro-transition-persist="bg"> <script type="module" src="/_astro/ProgressiveImage.astro_astro_type_script_index_0_lang.Zsl7yvEt.js"></script> <progressive-image data-url="/images/3e171a532cf6845d0fe58924cc998f9b1c7244546777b816d44fe196656b3c4b.webp" data-thumbnailUrl="/images/3e171a532cf6845d0fe58924cc998f9b1c7244546777b816d44fe196656b3c4b_48x.webp" data-image-class="object-cover object-center size-full pointer-events-none" data-astro-cid-njl3qch2="true" class="relative size-full pointer-events-none"> <img src="/images/3e171a532cf6845d0fe58924cc998f9b1c7244546777b816d44fe196656b3c4b_48x.webp" class="image-pixelated object-cover object-center size-full pointer-events-none" data-astro-cid-njl3qch2> </progressive-image>  </div> <div class="pointer-events-auto"><div class="absolute size-full max-w-7xl left-0 right-0 mx-auto sm:p-2"> <div class="sm:glassmorphism size-full rounded-md flex flex-row gap-2"> <div class="fixed w-full sm:w-50 lg:w-52 bottom-0 left-0 z-50 sm:static sm:flex sm:flex-col sm:overflow-auto no-scrollbar gap-2"> <div class="hidden sm:flex flex-col gap-1 justify-center items-center p-4" data-astro-transition-persist="author-info"> <img src="https://avatars.githubusercontent.com/u/62047803?v=4" alt="ç§‹é€¸" class="rounded-full size-24 select-none" loading="lazy"> <p class="text-2xl font-bold">æ¨ç§‹é€¸</p> <p class="text-sm">To Be A Geek :)</p> </div> <div class="flex flex-row sm:flex-col w-full justify-around border-none max-sm:glassmorphism sm:p-2"> <a class="transition-all flex flex-col items-center justify-center py-2 rounded-md max-sm:gap-0.5 sm:flex-row sm:justify-start sm:gap-4 sm:px-4 border-none  sm:glassmorphism" role="button" tabindex="0" href="/"> <div class="flex justify-center items-center"> <i class="icon-[material-symbols--nest-clock-farsight-analog] size-6 sm:size-8"></i> </div> <div class="text-xs sm:text-base select-none">  
Timeline
 </div> </a> <a class="transition-all flex flex-col items-center justify-center py-2 rounded-md max-sm:gap-0.5 sm:flex-row sm:justify-start sm:gap-4 sm:px-4 border-none" role="button" tabindex="0" href="/archive"> <div class="flex justify-center items-center"> <i class="icon-[icon-park-outline--calendar] size-6 sm:size-8"></i> </div> <div class="text-xs sm:text-base select-none">  
Archive
 </div> </a>   <a class="transition-all flex flex-col items-center justify-center py-2 rounded-md max-sm:gap-0.5 sm:flex-row sm:justify-start sm:gap-4 sm:px-4 border-none hidden sm:flex" role="button" tabindex="0" href="/friend-links/"> <div class="flex justify-center items-center"> <i class="icon-[icon-park-outline--friends-circle] size-6 sm:size-8"></i> </div> <div class="text-xs sm:text-base select-none">  
Friends
 </div> </a> <a class="transition-all flex flex-col items-center justify-center py-2 rounded-md max-sm:gap-0.5 sm:flex-row sm:justify-start sm:gap-4 sm:px-4 border-none max-sm:flex hidden" role="button" tabindex="0" href="/finder"> <div class="flex justify-center items-center"> <i class="icon-[ix--navigation] size-6 sm:size-8"></i> </div> <div class="text-xs sm:text-base select-none">  
Finder
 </div> </a> <a class="transition-all flex flex-col items-center justify-center py-2 rounded-md max-sm:gap-0.5 sm:flex-row sm:justify-start sm:gap-4 sm:px-4 border-none" role="button" tabindex="0" href="/about-me"> <div class="flex justify-center items-center"> <i class="icon-[material-symbols--sentiment-excited-outline] size-6 sm:size-8"></i> </div> <div class="text-xs sm:text-base select-none">  
About Me
 </div> </a> </div> <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).only=e;window.dispatchEvent(new Event("astro:only"));})();</script><script>(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t),11:t=>1/0*t},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="Z2plROE" component-url="/_astro/WindowsList.De5TXCyW.js" component-export="WindowsList" renderer-url="/_astro/client.DkS6DsO7.js" props="{&quot;className&quot;:[0,&quot;flex-1 hidden sm:flex flex-col gap-1 overflow-auto px-2&quot;]}" ssr client="only" opts="{&quot;name&quot;:&quot;WindowsList&quot;,&quot;value&quot;:&quot;solid-js&quot;}"></astro-island> </div> <main id="main-scroll-container" class="overflow-auto h-full flex-1 no-scrollbar"> <div class="p-2 sm:pl-0">  <div class="flex flex-col glassmorphism rounded-lg"> <header class="p-4 gap-3 flex items-center sm:hidden"> <img src="https://avatars.githubusercontent.com/u/62047803?v=4" alt="ç§‹é€¸" class="size-[3rem] rounded-full select-none" data-astro-transition-scope="astro-uniujczg-1"> <div class="flex flex-col"> <p class="break-all text-lg md:text-xl font-bold"> Nuxt/Nitro é›†æˆ Cloudflare D1 Database </p> <p class="text-sm"> æ¨ç§‹é€¸ Â· 2025-01-03 </p> </div> </header> <article class="prose max-sm:prose-sm dark:prose-invert text-inherit max-w-full py-4 px-4 md:px-8">  <h1 id="nuxtnitro-é›†æˆ-cloudflare-d1-database"><a href="#nuxtnitro-é›†æˆ-cloudflare-d1-database">Nuxt/Nitro é›†æˆ Cloudflare D1 Database</a></h1>
<h2 id="d1-database"><a href="#d1-database">D1 Database</a></h2>
<p>D1 æ˜¯ Cloudflare æä¾›çš„åˆ†å¸ƒå¼æ•°æ®åº“ï¼Œæœ¬èº«åŸºäº SQLite å¼€å‘ï¼Œå› æ­¤å¾ˆå¤š ORM éƒ½å¯ä»¥å¯¹æ¥ï¼ˆä¾‹å¦‚ <a href="https://www.prisma.io/docs/orm/overview/introduction/what-is-prisma"><code>Prisma ORM</code></a>, <a href="https://orm.drizzle.team/"><code>drizzle</code></a>ï¼‰ã€‚ä¸è¿‡æˆªæ­¢è‡³ 2025.01.02ï¼Œç¬”è€…å¹¶ä¸æ¨èä½¿ç”¨ Prisma æ¥æ­é… D1 Databaseï¼Œè¯šç„¶ Prisma æ˜¯ä¸€ä¸ªä¼˜ç§€çš„ ORM åº“ï¼Œä½†æ˜¯å®ƒçš„ Query Engine æ˜¯ç”¨çš„ WASMï¼Œä½“ç§¯æ¯”è¾ƒå¤§ï¼ŒCloudflare Worker å…è´¹è®¡åˆ’çš„å•ä¸ªé¡¹ç›®çš„æœ€å¤§ä½“ç§¯å¿…é¡»åœ¨ 3M ä»¥å†…ï¼ˆgzipï¼‰ï¼Œä»˜è´¹è®¡åˆ’æœ€å¤§ä½“ç§¯æ˜¯10Mï¼ˆgzipï¼‰<sup><a href="#user-content-fn-https://developers.cloudflare.com/workers/platform/limits/#worker-size" id="user-content-fnref-https://developers.cloudflare.com/workers/platform/limits/#worker-size" data-footnote-ref="" aria-describedby="footnote-label">1</a></sup>ï¼Œè¿™ç©ºé—´ååˆ†æ»´çè´µï¼Œä¸èƒ½æµªè´¹åœ¨è¿™ç§åœ°æ–¹ï¼ˆä½†æ˜¯Prismaæœªæ¥çš„è®¡åˆ’å°±æ˜¯é€æ­¥ç¼©å° Query Engine çš„ä½“ç§¯ï¼Œæ‰€ä»¥æœªæ¥è¯´ä¸å®šå¯ä»¥è€ƒè™‘ Prismaï¼‰ï¼Œå› æ­¤æœ¬æ–‡ä½¿ç”¨ drizzleã€‚</p>
<h2 id="wrangler"><a href="#wrangler">wrangler</a></h2>
<p><a href="https://www.npmjs.com/package/wrangler">wrangler</a> æ˜¯ Cloudflare æä¾›çš„çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œæä¾›äº†ä¸€ä¸ªç®€å•çš„æ¥å£ï¼Œå¯ä»¥è®©åœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒä¸­åˆ©ç”¨ <a href="https://github.com/cloudflare/miniflare">miniflare</a> åˆ›å»º Cloudflare Worker çš„æ¨¡æ‹Ÿç¯å¢ƒã€‚</p>
<p>é¦–å…ˆä½ éœ€è¦æœ‰ä¸€ä¸ª Cloudflare è´¦å·ï¼Œå¯¹æ­¤æœ¬æ–‡ä¸åšèµ˜è¿°ã€‚</p>
<h3 id="å®‰è£…"><a href="#å®‰è£…">å®‰è£…</a></h3>
<p>æˆ‘ä»¬å¯ä»¥åœ¨ä½ çš„é¡¹ç›®é‡Œä½¿ç”¨ä½ å–œçˆ±çš„åŒ…ç®¡ç†å®‰è£… wranglerã€‚</p>
<p><strong>pnpm</strong>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#B392F0">pnpm</span><span style="color:#9ECBFF"> add</span><span style="color:#79B8FF"> -D</span><span style="color:#9ECBFF"> wrangler</span></span></code></pre>
<p><strong>bun</strong>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#B392F0">bun</span><span style="color:#9ECBFF"> add</span><span style="color:#79B8FF"> -D</span><span style="color:#9ECBFF"> wrangler</span></span></code></pre>
<h3 id="ç™»å½•"><a href="#ç™»å½•">ç™»å½•</a></h3>
<p>åœ¨ä½¿ç”¨ wrangler åˆ›å»ºç¯å¢ƒå‰ï¼Œéœ€è¦å…ˆä½¿ç”¨è¿™æ¡æŒ‡ä»¤æ¥ç™»å½• cloudflareï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#B392F0">pnpx</span><span style="color:#9ECBFF"> wrangler</span><span style="color:#9ECBFF"> login</span></span></code></pre>
<p>ï¼ˆä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæœ¬æ–‡å°†ç”¨æ›´åŠ æµè¡Œçš„ pnpm æ¥è¿›è¡Œæ¼”ç¤ºï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯bunçš„è¯ï¼Œåªéœ€è¦æŠŠä¸‹é¢çš„æŒ‡ä»¤ä» <code>pnpx</code> æ¢æˆ <code>bunx</code> å³å¯ï¼‰</p>
<p>è¿™æ¡æŒ‡ä»¤ä¼šè‡ªåŠ¨ç”¨æµè§ˆå™¨æ‰“å¼€ä¸€ä¸ªæ ‡ç­¾é¡µï¼Œéœ€è¦ä½ ç™»å½•cloudflareè´¦å·ï¼Œç„¶åæˆæƒç™»å½•æœ¬åœ°çš„wranglerã€‚</p>
<h3 id="åˆ›å»º-d1-database"><a href="#åˆ›å»º-d1-database">åˆ›å»º D1 Database</a></h3>
<p>ç™»é™†å®Œ wrangler ä¹‹åå¯ä»¥ç”¨å‘½ä»¤è¡Œæ¥åˆ›å»º D1 æ•°æ®åº“äº†ï¼Œæˆ‘ä»¬ç”¨è¿™æ¡æŒ‡ä»¤å¯ä»¥åˆ›å»ºä¸€ä¸ªåä¸º Test çš„æ•°æ®åº“ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#B392F0">pnpx</span><span style="color:#9ECBFF"> wrangler</span><span style="color:#9ECBFF"> d1</span><span style="color:#9ECBFF"> create</span><span style="color:#9ECBFF"> Test</span></span></code></pre>
<p>ä¼šçœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#B392F0"> â›…ï¸</span><span style="color:#9ECBFF"> wrangler</span><span style="color:#79B8FF"> 3.99.0</span></span>
<span class="line"><span style="color:#B392F0">-------------------</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">âœ…</span><span style="color:#9ECBFF"> Successfully</span><span style="color:#9ECBFF"> created</span><span style="color:#9ECBFF"> DB</span><span style="color:#9ECBFF"> 'Test'</span><span style="color:#9ECBFF"> in</span><span style="color:#9ECBFF"> region</span><span style="color:#9ECBFF"> WNAM</span></span>
<span class="line"><span style="color:#B392F0">Created</span><span style="color:#9ECBFF"> your</span><span style="color:#9ECBFF"> new</span><span style="color:#9ECBFF"> D1</span><span style="color:#9ECBFF"> database.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79b8ff">[</span><span style="color:#ffab70">[</span><span style="color:#E1E4E8">d1_databases</span><span style="color:#ffab70">]</span><span style="color:#79b8ff">]</span></span>
<span class="line"><span style="color:#B392F0">binding</span><span style="color:#9ECBFF"> =</span><span style="color:#9ECBFF"> "DB"</span></span>
<span class="line"><span style="color:#B392F0">database_name</span><span style="color:#9ECBFF"> =</span><span style="color:#9ECBFF"> "Test"</span></span>
<span class="line"><span style="color:#B392F0">database_id</span><span style="color:#9ECBFF"> =</span><span style="color:#9ECBFF"> "a33752ea-32ed-4f44-80a3-71cf2cf55522"</span></span></code></pre>
<p>æŠŠ <code>[[d1_databases]]</code> åŠä»¥åçš„æ–‡æœ¬ç»™å¤åˆ¶ä¸‹æ¥ï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ªåä¸º <code>wrangler.toml</code> çš„æ–‡ä»¶ï¼ŒæŠŠåˆšæ‰å¤åˆ¶çš„å†…å®¹ç²˜è´´è¿›å», ç„¶ååœ¨è¯¥æ–‡ä»¶çš„å¼€å¤´åŠ ä¸Šå…³äºé¡¹ç›®çš„ä¸€äº›é…ç½®, ä¾‹å¦‚ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="toml"><code><span class="line"><span style="color:#E1E4E8">name=</span><span style="color:#9ECBFF">"cf-nitro"</span></span>
<span class="line"><span style="color:#E1E4E8">pages_build_output_dir=</span><span style="color:#9ECBFF">"dist"</span></span></code></pre>
<p>å…¶ä¸­ name æ˜¯é¡¹ç›®åç§°ï¼Œpages_build_output_dir æ˜¯ç¼–è¯‘ç»“æœçš„è¾“å‡ºæ–‡ä»¶å¤¹ã€‚æœ€ç»ˆæ•ˆæœå¦‚å›¾ï¼š</p>
<p><img alt="vscode: wrangler.toml" loading="lazy" decoding="async" fetchpriority="auto" width="1648" height="624" src="/_astro/image-2.AXO1yndK_PlAUr.webp" ></p>
<p><code>wrangler.toml</code> æ˜¯ Cloudflare Worker çš„é…ç½®æ–‡ä»¶ï¼Œè™½ç„¶ç°åœ¨å·²ç»æœ‰äº† <a href="https://github.com/cloudflare/workers-sdk/issues/2376">JSON æ ¼å¼</a>ï¼Œä½†æ˜¯ toml æ ¼å¼æ›´åŠ ç¨³å®šäº›ã€‚</p>
<p>æ­¤æ—¶æˆ‘ä»¬ç™»å½•ç½‘é¡µç«¯çš„ Cloudflare Dashboardï¼Œè¿›å…¥ <code>D1 SQL</code> é¡µé¢ï¼š</p>
<p><img alt="D1 SQL" loading="lazy" decoding="async" fetchpriority="auto" width="391" height="753" src="/_astro/image.BdzXqiR8_Z54zO5.webp" ></p>
<p>ä¼šçœ‹åˆ°å¤šå‡ºæ¥äº†ä¸€ä¸ªæ•°æ®åº“ï¼Œåä¸º Testï¼š</p>
<p><img alt="Test" loading="lazy" decoding="async" fetchpriority="auto" width="2010" height="600" src="/_astro/image-1.MLtfmy-2_Zy9HHm.webp" ></p>
<p>ä¹Ÿå¯ä»¥åœ¨å‘½ä»¤è¡Œé‡Œä½¿ç”¨ <code>pnpx wrangler d1 list</code> æ¥æŸ¥çœ‹å·²æœ‰çš„æ•°æ®åº“ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#F97583">></span><span style="color:#E1E4E8"> pnpx wrangler d1 list</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0"> â›…ï¸</span><span style="color:#9ECBFF"> wrangler</span><span style="color:#79B8FF"> 3.99.0</span></span>
<span class="line"><span style="color:#B392F0">-------------------</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span style="color:#B392F0">â”‚</span><span style="color:#9ECBFF"> uuid</span><span style="color:#9ECBFF">     â”‚</span><span style="color:#9ECBFF"> name</span><span style="color:#9ECBFF">   â”‚</span><span style="color:#9ECBFF"> created_at</span><span style="color:#9ECBFF">   â”‚</span><span style="color:#9ECBFF"> version</span><span style="color:#9ECBFF">    â”‚</span><span style="color:#9ECBFF"> num_tables</span><span style="color:#9ECBFF"> â”‚</span><span style="color:#9ECBFF"> file_size</span><span style="color:#9ECBFF"> â”‚</span></span>
<span class="line"><span style="color:#B392F0">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span></span>
<span class="line"><span style="color:#B392F0">â”‚</span><span style="color:#9ECBFF"> a3375...</span><span style="color:#9ECBFF"> â”‚</span><span style="color:#9ECBFF"> Test</span><span style="color:#9ECBFF">   â”‚</span><span style="color:#9ECBFF"> 2025-01-...</span><span style="color:#9ECBFF">  â”‚</span><span style="color:#9ECBFF"> production</span><span style="color:#9ECBFF"> â”‚</span><span style="color:#9ECBFF">            â”‚</span><span style="color:#9ECBFF">           â”‚</span></span>
<span class="line"><span style="color:#B392F0">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span></span></code></pre>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬çš„æ•°æ®åº“å·²ç»åˆ›å»ºå¥½äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¦ç”¨ ORM åº“æ¥åˆ›å»ºä¸€ä¸ªæ¼”ç¤ºç”¨çš„è¡¨ã€‚</p>
<h2 id="drizzle"><a href="#drizzle">drizzle</a></h2>
<p><a href="https://orm.drizzle.team/docs/get-started/d1-new">drizzle</a> æ˜¯ä¸€ä¸ªåŸºäº TypeScript çš„ ORM åº“ï¼Œå¾ˆæ—©å°±æ”¯æŒ D1 äº†ï¼Œå› æ­¤ä¹Ÿæ¯”è¾ƒæˆç†Ÿæ˜“ç”¨ã€‚</p>
<p>é¦–å…ˆå®‰è£…ä¾èµ–ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#B392F0">pnpm</span><span style="color:#9ECBFF"> add</span><span style="color:#79B8FF"> -D</span><span style="color:#9ECBFF"> drizzle-orm</span><span style="color:#9ECBFF"> drizzle-kit</span></span></code></pre>
<p>CLoudflare Worker çš„è¿è¡Œæ—¶å¹¶ä¸æ˜¯ NodeJSï¼Œè€Œæ˜¯ä»–ä»¬è‡ªç ”çš„ <a href="https://github.com/cloudflare/workerd">workerd</a>ï¼Œä¸ºäº†å…¼å®¹å¤§éƒ¨åˆ†çš„ NodeAPIï¼Œæˆ‘ä»¬è¦å¾€ <code>wrangler.toml</code> é‡Œå†™å…¥ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="toml"><code><span class="line"><span style="color:#E1E4E8">compatibility_flags = </span><span style="color:#79b8ff">[</span><span style="color:#E1E4E8"> </span><span style="color:#9ECBFF">"nodejs_compat"</span><span style="color:#E1E4E8"> </span><span style="color:#79b8ff">]</span></span>
<span class="line"><span style="color:#E1E4E8">compatibility_date = </span><span style="color:#9ECBFF">"2025-01-02"</span></span></code></pre>
<ul>
<li><code>compatibility_flags</code> è®¾ç½®ä¸º <code>["nodejs_compat"]</code> æ„å‘³ç€åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­åŒæ—¶å¯ç”¨äº† workerd å†…å»ºçš„ API å’Œ NodeJS çš„ polyfillsã€‚</li>
<li><code>compatibility_date</code> è®¾ç½®ä¸º <code>"2025-01-02"</code>ï¼Œè¡¨ç¤ºæˆ‘ä»¬ç¡®ä¿æˆ‘ä»¬çš„é¡¹ç›®å…¼å®¹æˆªæ­¢åˆ°2025å¹´1æœˆ2æ—¥çš„ Cloudflare Worker è¿è¡Œæ—¶ã€‚</li>
</ul>
<h3 id="schema"><a href="#schema">Schema</a></h3>
<p>æˆ‘ä»¬ä¸€ç›´è¯´ drizzle æ˜¯ä¸€ä¸ª ORM åº“ï¼Œè¿™æ„å‘³ç€ä»–çš„æ‰€æœ‰æ“ä½œï¼ˆå¢åˆ æ”¹æŸ¥ï¼Œåˆ›å»ºæ•°æ®åº“ç­‰ï¼‰éƒ½æ˜¯åŸºäº Schema æ¥å®Œæˆçš„ã€‚</p>
<p>æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­åˆ›å»ºä¸€ä¸ª <code>db/schema/user.ts</code>, å®šä¹‰ä¸€å¼ Userè¡¨ï¼Œå†™å…¥å¦‚ä¸‹ä»£ç ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> </span><span style="color:#79b8ff">{</span><span style="color:#E1E4E8"> int, sqliteTable, text </span><span style="color:#79b8ff">}</span><span style="color:#E1E4E8"> </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> "drizzle-orm/sqlite-core"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> const</span><span style="color:#79B8FF"> usersTable</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> sqliteTable</span><span style="color:#79b8ff">(</span><span style="color:#9ECBFF">"users_table"</span><span style="color:#E1E4E8">, </span><span style="color:#ffab70">{</span></span>
<span class="line"><span style="color:#E1E4E8">  id: </span><span style="color:#B392F0">int</span><span style="color:#b392f0">(</span><span style="color:#b392f0">)</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">primaryKey</span><span style="color:#b392f0">(</span><span style="color:#79b8ff">{</span><span style="color:#E1E4E8"> autoIncrement: </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8"> </span><span style="color:#79b8ff">}</span><span style="color:#b392f0">)</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  name: </span><span style="color:#B392F0">text</span><span style="color:#b392f0">(</span><span style="color:#b392f0">)</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">notNull</span><span style="color:#b392f0">(</span><span style="color:#b392f0">)</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  age: </span><span style="color:#B392F0">int</span><span style="color:#b392f0">(</span><span style="color:#b392f0">)</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">notNull</span><span style="color:#b392f0">(</span><span style="color:#b392f0">)</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  email: </span><span style="color:#B392F0">text</span><span style="color:#b392f0">(</span><span style="color:#b392f0">)</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">notNull</span><span style="color:#b392f0">(</span><span style="color:#b392f0">)</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">unique</span><span style="color:#b392f0">(</span><span style="color:#b392f0">)</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#ffab70">}</span><span style="color:#79b8ff">)</span><span style="color:#E1E4E8">;</span></span></code></pre>
<p>å¦‚å›¾ï¼š</p>
<p><img alt="vscode: db/schema/user.ts" loading="lazy" decoding="async" fetchpriority="auto" width="1561" height="858" src="/_astro/image-3.CowY0kq4_Z1pSuUf.webp" ></p>
<h3 id="drizzleconfigts"><a href="#drizzleconfigts">drizzle.config.ts</a></h3>
<p>ç°åœ¨æˆ‘ä»¬æœ‰äº† schemaï¼Œå°±å¯ä»¥ä½¿ç”¨ drizzle-kit æ¥ç”Ÿæˆ SQL è¯­å¥äº†ï¼Œä½†æ˜¯åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åˆ›å»ºä¸€ä¸ª <code>drizzle.config.ts</code>ï¼Œæ¥å‘Šè¯‰ <code>drizzle-kit</code> schema çš„ä½ç½®ï¼Œä»¥åŠç”Ÿæˆçš„ SQL è¯­å¥åº”è¯¥æ”¾ç½®åœ¨å“ªé‡Œï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> </span><span style="color:#79b8ff">{</span><span style="color:#E1E4E8"> defineConfig </span><span style="color:#79b8ff">}</span><span style="color:#E1E4E8"> </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> 'drizzle-kit'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> default</span><span style="color:#B392F0"> defineConfig</span><span style="color:#79b8ff">(</span><span style="color:#ffab70">{</span></span>
<span class="line"><span style="color:#E1E4E8">  out: </span><span style="color:#9ECBFF">'./drizzle'</span><span style="color:#E1E4E8">, </span><span style="color:#6A737D">// SQL çš„è¾“å‡ºè·¯å¾„</span></span>
<span class="line"><span style="color:#E1E4E8">  schema: </span><span style="color:#9ECBFF">'./server/db/schema'</span><span style="color:#E1E4E8">, </span><span style="color:#6A737D">// schema çš„ä½ç½®</span></span>
<span class="line"><span style="color:#E1E4E8">  dialect: </span><span style="color:#9ECBFF">'sqlite'</span><span style="color:#E1E4E8">, </span><span style="color:#6A737D">// æ­£å¦‚æˆ‘ä»¬ä¸Šæ–‡æ‰€è¯´ï¼ŒD1 æ˜¯åŸºäº SQLite çš„</span></span>
<span class="line"><span style="color:#ffab70">}</span><span style="color:#79b8ff">)</span><span style="color:#E1E4E8">;</span></span></code></pre>
<p>å¦‚å›¾ï¼š</p>
<p><img alt="vscode: drizzle.config.ts" loading="lazy" decoding="async" fetchpriority="auto" width="1327" height="778" src="/_astro/image-5.DKV4wNCZ_ZACtmj.webp" ></p>
<h3 id="ç”Ÿæˆ-sql"><a href="#ç”Ÿæˆ-sql">ç”Ÿæˆ SQL</a></h3>
<p>ç°åœ¨æˆ‘ä»¬æœ‰äº† schemaï¼Œä¹Ÿæœ‰äº† drizzle.config.tsï¼Œå¯ä»¥ç”¨ drizzle-kit ç”Ÿæˆ SQL è¯­å¥äº†ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#B392F0">pnpx</span><span style="color:#9ECBFF"> drizzle-kit</span><span style="color:#9ECBFF"> generate</span></span></code></pre>
<p>å¯ä»¥çœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#F97583">></span><span style="color:#E1E4E8"> pnpx drizzle-kit generate</span></span>
<span class="line"><span style="color:#B392F0">No</span><span style="color:#9ECBFF"> config</span><span style="color:#9ECBFF"> path</span><span style="color:#9ECBFF"> provided,</span><span style="color:#9ECBFF"> using</span><span style="color:#9ECBFF"> default</span><span style="color:#9ECBFF"> 'drizzle.config.ts'</span></span>
<span class="line"><span style="color:#B392F0">Reading</span><span style="color:#9ECBFF"> config</span><span style="color:#9ECBFF"> file</span><span style="color:#9ECBFF"> '...\drizzle.config.ts'</span></span>
<span class="line"><span style="color:#B392F0">1</span><span style="color:#9ECBFF"> tables</span></span>
<span class="line"><span style="color:#B392F0">users_table</span><span style="color:#79B8FF"> 4</span><span style="color:#9ECBFF"> columns</span><span style="color:#79B8FF"> 1</span><span style="color:#9ECBFF"> indexes</span><span style="color:#79B8FF"> 0</span><span style="color:#9ECBFF"> fks</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79b8ff">[</span><span style="color:#E1E4E8">âœ“</span><span style="color:#79b8ff">]</span><span style="color:#E1E4E8"> Your SQL migration file âœ drizzle</span><span style="color:#79B8FF">\0</span><span style="color:#E1E4E8">000_worthless_ravenous.sql ğŸš€</span></span></code></pre>
<p>ç„¶åæˆ‘ä»¬ä¼šå‘ç°è‡ªå·±çš„é¡¹ç›®ç›®å½•ä¸‹å¤šäº†ä¸€ä¸ªåä¸º <code>drizzle</code> çš„æ–‡ä»¶å¤¹ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªåä¸º <code>0000_worthless_ravenous.sql</code> çš„æ–‡ä»¶ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬çš„ drizzle ç”Ÿæˆçš„ SQL è¯­å¥äº†ã€‚å½“ç„¶ä½ çš„æ–‡ä»¶åå¯èƒ½ä¸æ˜¯ <code>0000_worthless_ravenous.sql</code>ï¼Œè¿™æ˜¯ drizzle ä½¿ç”¨éšæœºçš„å•è¯ç”Ÿæˆçš„ï¼Œæ— æ‰€è°“æ–‡ä»¶åï¼Œåªè¦ä¸é‡å¤å°±è¡Œäº†ã€‚</p>
<h2 id="è¿ç§»æ•°æ®åº“"><a href="#è¿ç§»æ•°æ®åº“">è¿ç§»æ•°æ®åº“</a></h2>
<p>ç°åœ¨æˆ‘ä»¬æœ‰äº† SQL è¯­å¥ï¼Œä¹Ÿç™»é™†å¥½äº† wranglerï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥ç”¨ wrangler æŠŠè¿™äº› SQL è¯­å¥åº”ç”¨åˆ° D1 æ•°æ®åº“ä¸Šäº†ã€‚</p>
<p>ä¸è¿‡ä¸ºäº†è®© wrangler çŸ¥é“æˆ‘ä»¬ç”Ÿæˆçš„ SQL æ–‡ä»¶çš„è·¯å¾„ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¾€ <code>wrangler.toml</code> é‡Œæ·»åŠ ä¸€è¡Œï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="toml"><code><span class="line"><span style="color:#E1E4E8">migrations_dir = </span><span style="color:#9ECBFF">"drizzle"</span></span></code></pre>
<p>å¦‚å›¾:</p>
<p><img alt="vscode: wrangler.toml append migrations_dir" loading="lazy" decoding="async" fetchpriority="auto" width="1903" height="873" src="/_astro/image-4.Cmwy-1Jm_VBpoQ.webp" ></p>
<p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥æ„‰å¿«åœ°ç”¨ wrangler è¿›è¡Œæ•°æ®åº“è¿ç§»äº†(è¿™æ¡æŒ‡ä»¤ä¸­çš„Testå°±æ˜¯æˆ‘ä»¬åˆšæ‰åˆ›å»ºçš„ Test æ•°æ®åº“ï¼Œå¦‚æœçš„ä½ æ•°æ®åº“ä½¿ç”¨äº†å…¶ä»–åå­—ï¼Œéœ€è¦è‡ªè¡Œæ›¿æ¢)ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#B392F0">pnpx</span><span style="color:#9ECBFF"> wrangler</span><span style="color:#9ECBFF"> d1</span><span style="color:#9ECBFF"> migrations</span><span style="color:#9ECBFF"> apply</span><span style="color:#9ECBFF"> Test</span><span style="color:#79B8FF"> --local</span></span></code></pre>
<p>ä½¿ç”¨è¿™æ¡æŒ‡ä»¤åä¼šçœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#B392F0"> â›…ï¸</span><span style="color:#9ECBFF"> wrangler</span><span style="color:#79B8FF"> 3.99.0</span></span>
<span class="line"><span style="color:#B392F0">-------------------</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">Migrations</span><span style="color:#9ECBFF"> to</span><span style="color:#9ECBFF"> be</span><span style="color:#9ECBFF"> applied:</span></span>
<span class="line"><span style="color:#B392F0">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span style="color:#B392F0">â”‚</span><span style="color:#9ECBFF"> name</span><span style="color:#9ECBFF">                        â”‚</span></span>
<span class="line"><span style="color:#B392F0">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span></span>
<span class="line"><span style="color:#B392F0">â”‚</span><span style="color:#9ECBFF"> 0000_worthless_ravenous.sql</span><span style="color:#9ECBFF"> â”‚</span></span>
<span class="line"><span style="color:#B392F0">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span style="color:#F97583">?</span><span style="color:#E1E4E8"> About to apply 1 migration</span><span style="color:#79b8ff">(</span><span style="color:#B392F0">s</span><span style="color:#79b8ff">)</span></span>
<span class="line"><span style="color:#B392F0">Your</span><span style="color:#9ECBFF"> database</span><span style="color:#9ECBFF"> may</span><span style="color:#9ECBFF"> not</span><span style="color:#9ECBFF"> be</span><span style="color:#9ECBFF"> available</span><span style="color:#9ECBFF"> to</span><span style="color:#9ECBFF"> serve</span><span style="color:#9ECBFF"> requests</span><span style="color:#9ECBFF"> during</span><span style="color:#9ECBFF"> the</span><span style="color:#9ECBFF"> migration,</span><span style="color:#9ECBFF"> continue?</span><span style="color:#9ECBFF"> Â»</span><span style="color:#E1E4E8"> </span><span style="color:#79b8ff">(</span><span style="color:#E1E4E8">Y/n</span><span style="color:#79b8ff">)</span></span></code></pre>
<p>æˆ‘ä»¬å›è½¦å³å¯ï¼š</p>
<p><img alt="wrangler d1 migrations apply --local" loading="lazy" decoding="async" fetchpriority="auto" width="1482" height="616" src="/_astro/image-6.BjVMMPVR_Z10HKS8.webp" ></p>
<p>ç­‰è¿™æ¡æŒ‡ä»¤æ‰§è¡Œå®Œï¼Œä¸å‡ºæ„å¤–çš„è¯ï¼Œæˆ‘ä»¬çš„é¡¹ç›®é‡Œä¼šå¤šå‡ºä¸€ä¸ª <code>.wrangler</code> æ–‡ä»¶å¤¹ï¼Œè¿™å°±æ˜¯ç”¨äºå­˜æ”¾ miniflare æ•°æ®çš„è·¯å¾„ã€‚</p>
<p><img alt="vscode: .wrangler" loading="lazy" decoding="async" fetchpriority="auto" width="798" height="177" src="/_astro/image-7.CF_xcqeg_Z18MYCa.webp" ></p>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬çš„ SQL è¯­å¥å·²ç»æˆåŠŸåº”ç”¨åˆ°æˆ‘ä»¬<strong>æœ¬åœ°</strong>çš„ D1 æ•°æ®åº“ä¸Šäº†ï¼Œç”¨ SQLite å·¥å…·é¢„è§ˆæ•°æ®åº“ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç»“æœ:</p>
<p><img alt="SQLite result" loading="lazy" decoding="async" fetchpriority="auto" width="1969" height="432" src="/_astro/image-8.C7OHuxK-_Z1vyjQR.webp" ></p>
<h2 id="åœ¨-nuxtnitro-ä¸­ä½¿ç”¨-d1-database"><a href="#åœ¨-nuxtnitro-ä¸­ä½¿ç”¨-d1-database">åœ¨ Nuxt/Nitro ä¸­ä½¿ç”¨ D1 Database</a></h2>
<p>åœ¨ä¸Šæ–‡ä¸­ï¼Œæˆ‘ä»¬å·²ç»åˆ›å»ºå®Œäº†ä¸€ä¸ªåä¸º Test çš„ D1 æ•°æ®åº“ï¼Œæ¥ä¸‹æ¥å¯ä»¥åœ¨æˆ‘ä»¬çš„ Nuxt/Nitro é¡¹ç›®ä¸­ä½¿ç”¨äº†ã€‚</p>
<p>(ç”±äº Nuxt æ˜¯åŸºäº Nitro å’Œ Vue çš„ä¸€ä¸ªå‰ç«¯æ¡†æ¶ï¼Œå› æ­¤æœ¬æ–‡ä»‹ç»çš„æ–¹æ³•åŒæ ·å¯ä»¥åœ¨ Nuxt æ¡†æ¶ä¸­ä½¿ç”¨ã€‚)</p>
<p>ç„¶åæˆ‘ä»¬å®‰è£… <a href="https://github.com/nitrojs/nitro-cloudflare-dev"><code>nitro-cloudflare-dev</code></a>ï¼Œè¿™æ˜¯ nitro çš„ä¸€ä¸ª module, å…è®¸åœ¨ nitro çš„ dev Server ä¸­ä½¿ç”¨ wrangler å’Œ miniflare æš´éœ²çš„ <a href="https://github.com/cloudflare/workers-sdk/pull/5002">getPlatformProxy API</a> æ¥è®¿é—® Cloudflare runtime platform:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#B392F0">pnpm</span><span style="color:#9ECBFF"> add</span><span style="color:#79B8FF"> -D</span><span style="color:#9ECBFF"> nitro-cloudflare-dev</span></span></code></pre>
<p><code>nitro-cloudflare-dev</code> ä¼šæŸ¥æ‰¾æœ€è¿‘çš„ <code>wrangler.toml</code>ï¼Œå¹¶è‡ªåŠ¨å¾€ nitro ä¸­æ³¨å…¥æ­£ç¡®çš„ç¯å¢ƒå˜é‡ï¼Œéå¸¸æ–¹ä¾¿ã€‚</p>
<h3 id="å¯¹äº-nuxt"><a href="#å¯¹äº-nuxt">å¯¹äº Nuxt</a></h3>
<p>åªéœ€è¦æ›´æ–° <code>nuxt.config.ts</code>ï¼ŒåŠ å…¥å¦‚ä¸‹ä»£ç å³å¯ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> default</span><span style="color:#B392F0"> defineNuxtConfig</span><span style="color:#79b8ff">(</span><span style="color:#ffab70">{</span></span>
<span class="line"><span style="color:#E1E4E8">  modules: </span><span style="color:#b392f0">[</span><span style="color:#9ECBFF">"nitro-cloudflare-dev"</span><span style="color:#b392f0">]</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#ffab70">}</span><span style="color:#79b8ff">)</span><span style="color:#E1E4E8">;</span></span></code></pre>
<h3 id="å¯¹äº-nitro"><a href="#å¯¹äº-nitro">å¯¹äº Nitro</a></h3>
<p>å¯¹äº Nitro æ›´æ–° <code>nitro.config.ts</code>ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> nitroCloudflareBindings </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> "nitro-cloudflare-dev"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> default</span><span style="color:#B392F0"> defineNitroConfig</span><span style="color:#79b8ff">(</span><span style="color:#ffab70">{</span></span>
<span class="line"><span style="color:#E1E4E8">  modules: </span><span style="color:#b392f0">[</span><span style="color:#E1E4E8">nitroCloudflareBindings</span><span style="color:#b392f0">]</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#ffab70">}</span><span style="color:#79b8ff">)</span><span style="color:#E1E4E8">;</span></span></code></pre>
<h3 id="å®šä¹‰ä¸­é—´ä»¶ä½¿ç”¨-d1"><a href="#å®šä¹‰ä¸­é—´ä»¶ä½¿ç”¨-d1">å®šä¹‰ä¸­é—´ä»¶ä½¿ç”¨ D1</a></h3>
<p>ä¸­é—´ä»¶æ˜¯å¤§éƒ¨åˆ†åç«¯æ¡†æ¶éƒ½æœ‰çš„åŠŸèƒ½ï¼Œ<a href="https://nitro.build/guide/routing#middleware">nitro ä¹Ÿä¸ä¾‹å¤–</a>ã€‚ä½ ä½¿ç”¨çš„æ˜¯ Nuxtï¼Œå¯ä»¥å‚è€ƒ<a href="https://nuxt.com/docs/guide/directory-structure/server#server-middleware">å®˜æ–¹æ–‡æ¡£</a> æ¥äº†è§£ä¸­é—´ä»¶ã€‚</p>
<p>æœ¬æ–‡åŸºäº nitro è¿›è¡Œä»‹ç»ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯ nuxtï¼Œé‚£ä¹ˆå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯ä¸­é—´ä»¶çš„è·¯å¾„ä¸åŒï¼Œä»£ç æ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœä½ ä¸äº†è§£ä¸­é—´ä»¶çš„è¯ï¼Œæ— è®ºå¦‚ä½•éƒ½è¯·å…ˆçœ‹ä¸€ä¸‹å®˜æ–¹æ•™ç¨‹ï¼</p>
<p>é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª <code>server/middleware/d1.ts</code> çš„æ–‡ä»¶ï¼Œé‡Œé¢å†™å…¥å¦‚ä¸‹ä»£ç ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> </span><span style="color:#79b8ff">{</span><span style="color:#E1E4E8"> drizzle, DrizzleD1Database </span><span style="color:#79b8ff">}</span><span style="color:#E1E4E8"> </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> 'drizzle-orm/d1'</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#79B8FF"> *</span><span style="color:#F97583"> as</span><span style="color:#E1E4E8"> schema </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> '~/db/schema/user'</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">declare</span><span style="color:#F97583"> module</span><span style="color:#9ECBFF"> 'h3'</span><span style="color:#E1E4E8"> </span><span style="color:#79b8ff">{</span></span>
<span class="line"><span style="color:#F97583">	interface</span><span style="color:#B392F0"> H3EventContext</span><span style="color:#E1E4E8"> </span><span style="color:#ffab70">{</span></span>
<span class="line"><span style="color:#FFAB70">		db</span><span style="color:#F97583">:</span><span style="color:#B392F0"> DrizzleD1Database</span><span style="color:rgba(255, 18, 18, 0.8)">&#x3C;</span><span style="color:#F97583">typeof</span><span style="color:#E1E4E8"> schema</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">	</span><span style="color:#ffab70">}</span></span>
<span class="line"><span style="color:#79b8ff">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> cloudflare</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> default</span><span style="color:#B392F0"> defineEventHandler</span><span style="color:#79b8ff">(</span><span style="color:#F97583">async</span><span style="color:#E1E4E8"> </span><span style="color:#ffab70">(</span><span style="color:#b392f0">{</span><span style="color:#E1E4E8"> </span><span style="color:#FFAB70">context</span><span style="color:#E1E4E8"> </span><span style="color:#b392f0">}</span><span style="color:#ffab70">)</span><span style="color:#E1E4E8"> </span><span style="color:#F97583">=</span><span style="color:#F97583">></span><span style="color:#E1E4E8"> </span><span style="color:#ffab70">{</span></span>
<span class="line"><span style="color:#E1E4E8">	cloudflare </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> context.cloudflare </span><span style="color:#F97583">||</span><span style="color:#E1E4E8"> cloudflare</span></span>
<span class="line"><span style="color:#6A737D">	// è¿™é‡Œä¹‹æ‰€ä»¥æ˜¯ DB æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨ `wrangler.toml` é‡ŒæŠŠ binding è®¾ç½®ä¸ºäº† "DB"</span></span>
<span class="line"><span style="color:#F97583">	const</span><span style="color:#E1E4E8"> </span><span style="color:#b392f0">{</span><span style="color:#E1E4E8"> </span><span style="color:#79B8FF">DB</span><span style="color:#E1E4E8"> </span><span style="color:#b392f0">}</span><span style="color:#E1E4E8"> </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> </span><span style="color:#b392f0">(</span><span style="color:#E1E4E8">context.cloudflare </span><span style="color:#F97583">||</span><span style="color:#E1E4E8"> cloudflare</span><span style="color:#b392f0">)</span><span style="color:#E1E4E8">.env</span></span>
<span class="line"><span style="color:#E1E4E8">	context.db </span><span style="color:#F97583">=</span><span style="color:#B392F0"> drizzle</span><span style="color:#b392f0">(</span><span style="color:#79B8FF">DB</span><span style="color:#E1E4E8">, </span><span style="color:#79b8ff">{</span><span style="color:#E1E4E8"> schema: </span><span style="color:#ffab70">{</span><span style="color:#E1E4E8"> </span><span style="color:#F97583">...</span><span style="color:#E1E4E8">schema </span><span style="color:#ffab70">}</span><span style="color:#E1E4E8"> </span><span style="color:#79b8ff">}</span><span style="color:#b392f0">)</span></span>
<span class="line"><span style="color:#ffab70">}</span><span style="color:#79b8ff">)</span></span></code></pre>
<p>å¦‚å›¾ï¼š</p>
<p><img alt="vscode: server/middleware/d1" loading="lazy" decoding="async" fetchpriority="auto" width="1534" height="892" src="/_astro/image-9.NWgbInkE_Z2regXI.webp" ></p>
<p>ç”±äºåœ¨ç»è¿‡ä»»æ„ä¸€ä¸ªè·¯ç”±çš„æ—¶å€™éƒ½ä¼šå…ˆç»è¿‡ä¸­é—´ä»¶ï¼Œæ‰€ä»¥æ¯ä¸ªè·¯ç”±çš„contexté‡Œéƒ½ä¼šæœ‰ä¸€ä¸ªåä¸ºdbçš„å±æ€§ï¼Œè¿™ä¾¿æ˜¯æˆ‘ä»¬çš„ DrizzleD1Database å¯¹è±¡ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ <code>server/routes/index.ts</code> ä¸­å†™å…¥å¦‚ä¸‹ä»£ç ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> </span><span style="color:#79b8ff">{</span><span style="color:#E1E4E8"> eq </span><span style="color:#79b8ff">}</span><span style="color:#E1E4E8"> </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> "drizzle-orm"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> </span><span style="color:#79b8ff">{</span><span style="color:#E1E4E8"> usersTable </span><span style="color:#79b8ff">}</span><span style="color:#E1E4E8"> </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> "~/db/schema/user"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> default</span><span style="color:#B392F0"> eventHandler</span><span style="color:#79b8ff">(</span><span style="color:#F97583">async</span><span style="color:#E1E4E8"> </span><span style="color:#ffab70">(</span><span style="color:#FFAB70">event</span><span style="color:#ffab70">)</span><span style="color:#E1E4E8"> </span><span style="color:#F97583">=</span><span style="color:#F97583">></span><span style="color:#E1E4E8"> </span><span style="color:#ffab70">{</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> zhangsan</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> </span><span style="color:#b392f0">(</span><span style="color:#F97583">await</span><span style="color:#E1E4E8"> event.context.db.</span><span style="color:#B392F0">select</span><span style="color:#79b8ff">(</span><span style="color:#79b8ff">)</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">from</span><span style="color:#79b8ff">(</span><span style="color:#E1E4E8">usersTable</span><span style="color:#79b8ff">)</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">where</span><span style="color:#79b8ff">(</span><span style="color:#B392F0">eq</span><span style="color:#ffab70">(</span><span style="color:#E1E4E8">usersTable.name, </span><span style="color:#9ECBFF">"zhangsan"</span><span style="color:#ffab70">)</span><span style="color:#79b8ff">)</span><span style="color:#b392f0">)</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">at</span><span style="color:#b392f0">(</span><span style="color:#79B8FF">0</span><span style="color:#b392f0">)</span></span>
<span class="line"><span style="color:#F97583">  if</span><span style="color:#b392f0">(</span><span style="color:#E1E4E8">zhangsan</span><span style="color:#b392f0">)</span><span style="color:#E1E4E8"> </span><span style="color:#b392f0">{</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> zhangsan</span></span>
<span class="line"><span style="color:#E1E4E8">  </span><span style="color:#b392f0">}</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> res</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#E1E4E8"> event.context.db.</span><span style="color:#B392F0">insert</span><span style="color:#b392f0">(</span><span style="color:#E1E4E8">usersTable</span><span style="color:#b392f0">)</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">values</span><span style="color:#b392f0">(</span><span style="color:#79b8ff">{</span></span>
<span class="line"><span style="color:#E1E4E8">    name: </span><span style="color:#9ECBFF">"zhangsan"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    age: </span><span style="color:#79B8FF">18</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    email: </span><span style="color:#9ECBFF">"zhangsan@outlook.com"</span></span>
<span class="line"><span style="color:#E1E4E8">  </span><span style="color:#79b8ff">}</span><span style="color:#b392f0">)</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> </span><span style="color:#b392f0">{</span></span>
<span class="line"><span style="color:#E1E4E8">    ok: </span><span style="color:#79B8FF">true</span></span>
<span class="line"><span style="color:#E1E4E8">  </span><span style="color:#b392f0">}</span></span>
<span class="line"><span style="color:#ffab70">}</span><span style="color:#79b8ff">)</span><span style="color:#E1E4E8">;</span></span></code></pre>
<p>å¦‚å›¾ï¼š</p>
<p><img alt="vscode: server/routes/index" loading="lazy" decoding="async" fetchpriority="auto" width="2280" height="1020" src="/_astro/image-10.CEOJH5E8_23Ie1k.webp" ></p>
<p>ç„¶åå¯åŠ¨æˆ‘ä»¬çš„é¡¹ç›®ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#B392F0">pnpm</span><span style="color:#9ECBFF"> dev</span></span></code></pre>
<p>ç¬¬ä¸€æ¬¡æ‰“å¼€çš„æ—¶å€™ä¼šå¾€æ•°æ®åº“é‡Œå†™å…¥æ•°æ®, ç¬¬äºŒæ¬¡æ‰“å¼€çš„æ—¶å€™å°±ä¼šä»æ•°æ®åº“é‡Œå–å‡ºæ•°æ®å¹¶è¿”å›ã€‚</p>
<h2 id="éƒ¨ç½²"><a href="#éƒ¨ç½²">éƒ¨ç½²</a></h2>
<h3 id="è¿ç§»åˆ°åˆ†å¸ƒå¼æ•°æ®åº“"><a href="#è¿ç§»åˆ°åˆ†å¸ƒå¼æ•°æ®åº“">è¿ç§»åˆ°åˆ†å¸ƒå¼æ•°æ®åº“</a></h3>
<p>åˆšæ‰æˆ‘ä»¬ä»…ä»…æŠŠ SQL åº”ç”¨åˆ°äº†æœ¬åœ°ç¯å¢ƒé‡Œï¼Œé‚£ä¹ˆç°åœ¨æˆ‘ä»¬è¦æŠŠ SQL è¿ç§»åˆ°æ­£ç»çš„çº¿ä¸Šç¯å¢ƒé‡Œï¼Œå¯ä»¥ä½¿ç”¨è¿™æ¡æŒ‡ä»¤:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#B392F0">pnpx</span><span style="color:#9ECBFF"> wrangler</span><span style="color:#9ECBFF"> d1</span><span style="color:#9ECBFF"> migrations</span><span style="color:#9ECBFF"> apply</span><span style="color:#9ECBFF"> Test</span><span style="color:#79B8FF"> --remote</span></span></code></pre>
<h3 id="éƒ¨ç½²-1"><a href="#éƒ¨ç½²-1">éƒ¨ç½²</a></h3>
<p>ä»¥ä¸Šä¾¿æ˜¯ä½¿ç”¨ Cloudflare Worker + D1 Database å¼€å‘çš„å…¨éƒ¨æµç¨‹ï¼Œå¦‚æœä½ ä¸€åˆ‡å°±ç»ªï¼Œå°±å·®éƒ¨ç½²åˆ° Cloudflareï¼Œé‚£ä¹ˆåªè¦æŠŠè¿™ä¸ªé¡¹ç›®ä¸Šä¼ åˆ° GitHubï¼Œç„¶åè¿›å…¥ Cloudflare çš„ Dashboardï¼Œç‚¹å‡»åˆ›å»º Workerï¼Œå†ç‚¹å‡»è¿æ¥åˆ° gitï¼Œæœ€åé€‰æ‹©ä½ çš„é¡¹ç›®æ‰€åœ¨çš„ä»“åº“å³å¯ï¼š</p>
<p><img alt="cloudflare dashboard: connect git" loading="lazy" decoding="async" fetchpriority="auto" width="2311" height="777" src="/_astro/image-11.9dy9Qr3o_1HMT5G.webp" ></p>
<p>å¦‚æœä½ æŠŠ <code>wrangler.toml</code> æ”¾åœ¨ä½ çš„é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œé‚£ä¹ˆ Cloudflare æ˜¯ä¼šè‡ªåŠ¨æŠŠæ•°æ®åº“æ³¨å…¥åˆ°ä½ çš„é¡¹ç›®é‡Œï¼Œå¦‚æœä½ æƒ³æ‰‹åŠ¨æ³¨å…¥çš„è¯ï¼Œå¯ä»¥åœ¨ <code>Workers &#x26; Pages</code> -> é€‰æ‹©ä¸€ä¸ªé¡¹ç›® -> <code>è®¾ç½®</code> -> <code>ç»‘å®š</code>ï¼Œç„¶åé€‰æ‹© <code>D1 Database</code>ï¼Œè¾“å…¥<strong>ç»‘å®šåç§°</strong>ï¼Œå¹¶ä¸”é€‰æ‹©ä½ çš„æ•°æ®åº“å³å¯ï¼š</p>
<p><img alt="cloudflare dashboard: bind d1" loading="lazy" decoding="async" fetchpriority="auto" width="1078" height="579" src="/_astro/image-12.CtWgsBHN_ZrJrAo.webp" ></p>
<p>å¦‚æœä½ çš„ç»‘å®šåç§°è¾“å…¥çš„ä¸æ˜¯ <code>DB</code> çš„è¯ï¼Œè¿˜éœ€è¦ä¿®æ”¹ä¸€ä¸‹ä½ çš„ä¸­é—´ä»¶ï¼Œå¯ä»¥å‚è€ƒæˆ‘åœ¨ä¸Šæ–‡çš„ <code>d1.ts</code> ä¸­å†™çš„æ³¨é‡Šã€‚</p>
<section data-footnotes="" class="footnotes"><h2 class="sr-only" id="footnote-label"><a href="#footnote-label">Footnotes</a></h2>
<ol>
<li id="user-content-fn-https://developers.cloudflare.com/workers/platform/limits/#worker-size">
<p><a href="https://developers.cloudflare.com/workers/platform/limits/#worker-size">https://developers.cloudflare.com/workers/platform/limits/#worker-size</a> <a href="#user-content-fnref-https://developers.cloudflare.com/workers/platform/limits/#worker-size" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">â†©</a></p>
</li>
</ol>
</section>  </article> </div> <div class="max-sm:glassmorphism rounded-lg mt-2 sm:mt-6 p-2 pt-6"> <script type="module" src="/_astro/Giscus.astro_astro_type_script_index_0_lang.C2pfN53L.js"></script> <giscus-widget repo="miaobuao/miaobuao.github.io" repoId="R_kgDOJONNeg" categoryId="DIC_kwDOJONNes4CVJhu" mapping="og:title" strict="0" reactionsEnabled="1" emitMetadata="0" inputPosition="top" theme="preferred_color_scheme" lang="zh-CN" loading="lazy"></giscus-widget> </div> <div class="h-16 sm:h-0"></div>  </div> </main> </div> </div></div> </div><astro-island uid="gD63X" component-url="/_astro/WindowManager.DgB5G-u_.js" component-export="WindowManager" renderer-url="/_astro/client.DkS6DsO7.js" props="{&quot;class&quot;:[0,&quot;invisible md:visible not-md:pointer-events-none&quot;],&quot;data-astro-transition-persist&quot;:[0,&quot;wm&quot;]}" ssr client="only" opts="{&quot;name&quot;:&quot;WindowManager&quot;,&quot;value&quot;:&quot;solid-js&quot;}" data-astro-transition-persist="wm"></astro-island>  </body></html> <script defer>
	window.addEventListener(
		'wheel',
		(e) => {
			const scrollContainer = document.getElementById('main-scroll-container')
			if (e.target !== document.body) {
				return
			}
			e.preventDefault()
			scrollContainer.scrollTop += e.deltaY
		},
		{ passive: false },
	)
</script>